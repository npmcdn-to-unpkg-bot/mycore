<?xml version="1.0" encoding="ISO-8859-1"?>

<!-- ============================================== -->
<!--      MyCoRe-WCMS build file for use with ANT        -->
<!-- $Revision$ $Date$ -->
<!-- ============================================== -->

<project name="MyCoReWCMS" default="usage" basedir="../..">

	<!-- ============================================== -->

	<property name="build.sysclasspath" value="last" />

  <!-- =================================================================== -->
  <!-- Global properties                                                   -->
  <!-- =================================================================== -->
	
	<!-- Provide a default value for MYCORE_HOME if not set in env -->
	<property name="env.MYCORE_HOME" value="/home/mcrclient/workspace/mycore" />

	<!-- Provide a default value for MYCOREWCMS_HOME if not set -->
	<property name="env.MYCOREWCMS_HOME" value="/home/mcrclient/workspace/mycorewcms_new" />

	  <!-- Read in environment variables -->
	  <property environment="env" />
	  <property name="this.unixtools"             value="${env.MYCOREWCMS_HOME}/unixtools"/>
	  <property name="this.webapps"               value="${env.MYCOREWCMS_HOME}/webapps"/>
	
	<!-- ============================================== -->

	<target name="usage">
		<echo>
		      Use the ant tool to plug in MyCoReWCMS-Module:
		      Usage: ant [target] [target] [target] ...

		      Available targets for MyCoReWCMS are:

				webapp		  	update MyCoReWCMS-Module as a standalone application
		</echo>
	</target>

	<!-- ============================================== -->

	<target name="standalone">
		<echo>
	           Building directories for MyCoReWCMS-Module  ...
	    </echo>			
		<mkdir dir="${env.MYCOREWCMS_HOME}/modules/module-wcms" />
		<mkdir dir="${env.MYCOREWCMS_HOME}/stylesheets/modules/module-wcms" />					

		<echo>
	           Installing MyCoReWCMS-Module...
	    </echo>
		<copy todir="${env.MYCOREWCMS_HOME}/modules/module-wcms/aif/archive" preservelastmodified="yes">
	        	<fileset dir="${env.MYCORE_HOME}/modules/module-wcms/aif/archive" />
   		</copy>			
		<copy todir="${env.MYCOREWCMS_HOME}/modules/module-wcms/aif/config" preservelastmodified="yes">
	        	<fileset dir="${env.MYCORE_HOME}/modules/module-wcms/aif/config" />
   		</copy>			
		<copy todir="${env.MYCOREWCMS_HOME}/modules/module-wcms/aif/web/admin" preservelastmodified="yes">
	        	<fileset dir="${env.MYCORE_HOME}/modules/module-wcms/aif/web/admin" />
   		</copy>			
		
		<copy todir="${env.MYCOREWCMS_HOME}/modules/module-wcms/uif" preservelastmodified="yes">
	        	<fileset dir="${env.MYCORE_HOME}/modules/module-wcms/uif"  />
   		</copy>					
	    <delete dir="${env.MYCOREWCMS_HOME}/modules/module-wcms/uif/templates"    />		
		
		<copy todir="${env.MYCOREWCMS_HOME}/modules/module-wcms/templates" preservelastmodified="yes">
	        	<fileset dir="${env.MYCORE_HOME}/modules/module-wcms/uif/templates" />
   		</copy>							

		<!-- get docportal stylesheets -->
		<copy todir="${env.MYCOREWCMS_HOME}/stylesheets/modules/module-wcms" preservelastmodified="yes">
	        	<fileset dir="${env.MYCORE_HOME}/modules/module-wcms/appsSupport/standalone/uif/xsl" includes="*.xsl" />
   		</copy>					
		<!-- get config folder for private configuration -->
		<copy todir="${env.MYCOREWCMS_HOME}/config" preservelastmodified="yes">
	        	<fileset dir="${env.MYCORE_HOME}/modules/module-wcms/appsSupport/standalone/install/config" />
   		</copy>		
		
		<!-- get build file -->
		<copy todir="${env.MYCOREWCMS_HOME}" preservelastmodified="yes">
	        	<fileset dir="${env.MYCORE_HOME}/modules/module-wcms/appsSupport/standalone" >
	                <include name="build.xml"/>
	              </fileset>			
   		</copy>			              	
		
	</target>

	<!-- ============================================== -->

	<target name="clean" >
		<echo>
	           Removing MyCoReWCMS-Module...
	    </echo>
	
	    <delete dir="${env.MYCOREWCMS_HOME}/webapps"    />

	</target>

	<!-- ============================================== -->
	<!-- ============================================== -->	

	<target name="compile">
		<echo>

      Compiling MyCoReWCMS-Module classes from source code to directory classes ...
    </echo>

		<path id="compiling.classpath">
			<fileset dir="${env.MYCORE_HOME}/lib">
				<include name="*.jar" />
			</fileset>
				<fileset dir="${env.MYCORE_HOME}/modules/module-wcms/aif/lib">
					<include name="*.jar" />
				</fileset>			
		</path>

		<path id="running.classpath">
			<path refid="compiling.classpath" />
			<pathelement location="classes" />
		</path>
		
		<mkdir dir="${env.MYCORE_HOME}/modules/module-wcms/aif/classes" />			
		<javac srcdir="${env.MYCORE_HOME}/modules/module-wcms/aif/src" 
			destdir="${env.MYCORE_HOME}/modules/module-wcms/aif/classes" classpathref="compiling.classpath" debug="on" optimize="on" deprecation="off" />

	</target>

	<!-- ============================================== -->	
	
	<target name="webapp" depends="prepareMycoreBasics.webapp,standalone,compile">
		<echo>
	           Updating MyCoReWCMS-Module ...
	    </echo>

		<!-- copy java sources -->
		<copy todir="${env.MYCOREWCMS_HOME}/webapps/WEB-INF/classes" preservelastmodified="yes">
			<fileset dir="${env.MYCORE_HOME}/modules/module-wcms/aif/classes" />
			<fileset dir="${env.MYCOREWCMS_HOME}/modules/module-wcms/aif/config">
				<include name="mycore.properties.wcms" />
			</fileset>
		</copy>		
		<copy todir="${env.MYCOREWCMS_HOME}/webapps/WEB-INF/lib" preservelastmodified="yes">
			<fileset dir="${env.MYCORE_HOME}/modules/module-wcms/aif/lib">
				<include name="jtidy.jar" />
			</fileset>
		</copy>		
		
		<!-- ===================== copy right xsl ========================== -->
		<copy todir="${env.MYCOREWCMS_HOME}/webapps/WEB-INF/stylesheets" preservelastmodified="yes" flatten="true">
			<fileset dir="${env.MYCOREWCMS_HOME}/modules/module-wcms/templates/master">
				<include name="**/*.xsl" />
			</fileset>
				<fileset dir="${env.MYCOREWCMS_HOME}/stylesheets/modules/module-wcms">
					<include name="**/*.xsl" />
				</fileset>			
		</copy>		
			
		<copy todir="${env.MYCOREWCMS_HOME}/webapps/WEB-INF/stylesheets" preservelastmodified="yes" flatten="true">
			<!-- aif -->			
			<fileset dir="${env.MYCORE_HOME}/modules/module-wcms/aif/xsl">
				<include name="**/*.xsl" />
			</fileset>
			<!-- uif -->
			<fileset dir="${env.MYCOREWCMS_HOME}/modules/module-wcms/uif/xsl">
				<include name="**/*.xsl" />
			</fileset>			
		</copy>		
		
		<!-- get templates -->
		<copy todir="${env.MYCOREWCMS_HOME}/webapps/modules/module-wcms/templates" preservelastmodified="yes">
			<fileset dir="${env.MYCOREWCMS_HOME}/modules/module-wcms/templates" />
		</copy>		
		
		<!-- =========== get default content ============ -->
		<!-- web pages -->
		<copy todir="${env.MYCOREWCMS_HOME}/webapps/content" preservelastmodified="yes" >
			<fileset dir="${env.MYCOREWCMS_HOME}/modules/module-wcms/uif/web/content">
			</fileset>
		</copy>				
		<delete file="${env.MYCOREWCMS_HOME}/webapps/index.html" />		
		<copy todir="${env.MYCOREWCMS_HOME}/webapps" preservelastmodified="yes">
			<fileset dir="${env.MYCOREWCMS_HOME}/modules/module-wcms/uif/web" >
				<include name="index.html" />
			</fileset>
		</copy>		
		<!-- aif used web stuff -->
		<copy todir="${env.MYCOREWCMS_HOME}/webapps/modules/module-wcms/aif/admin" preservelastmodified="yes">
			<fileset dir="${env.MYCOREWCMS_HOME}/modules/module-wcms/aif/web/admin" />
		</copy>
		<!-- uif used web stuff -->		
		<copy todir="${env.MYCOREWCMS_HOME}/webapps/modules/module-wcms/uif/common" preservelastmodified="yes">
			<fileset dir="${env.MYCOREWCMS_HOME}/modules/module-wcms/uif/web/common" />
		</copy>		
		<!-- web stuff for template docportal support -->
		<copy todir="${env.MYCOREWCMS_HOME}/webapps/css" preservelastmodified="yes">
			<fileset dir="${env.MYCOREWCMS_HOME}/webpages/css" />
		</copy>			   	  		  	
		<copy todir="${env.MYCOREWCMS_HOME}/webapps/images" preservelastmodified="yes">
			<fileset dir="${env.MYCOREWCMS_HOME}/webpages/images" />
		</copy>			   	  		  	
	
		<!-- get kupu to webapps -->
		<copy todir="${env.MYCOREWCMS_HOME}/webapps/modules/module-wcms/thirdParty/kupu" preservelastmodified="yes">			
			<fileset dir="${env.MYCORE_HOME}/modules/module-wcms/thirdParty/kupu" />
		</copy>				
		
	</target>	

	<!-- ============================================== -->

	  <target name="prepareMycoreBasics.init" >	

	    <mkdir dir="${this.unixtools}"  />
	    <mkdir dir="${this.webapps}" />

	    <!-- Fail if environment variables are not set -->
	    <fail message="Environment variable JAVA_HOME is not set!"   unless="env.JAVA_HOME"   />
	    <fail message="Environment variable MYCORE_HOME is not set!" unless="env.MYCORE_HOME" />

	    <path id="this.classpath">
	      <fileset dir="${env.MYCORE_HOME}/lib" includes="*.jar"/>
	    </path>

	    <condition property="detected.os" value="unix"> <os family="unix"/> </condition>
	    <condition property="detected.os" value="windows"> <os family="dos"/> </condition>
	    <condition property="os.is.unix"> <os family="unix"/> </condition>
	    <condition property="os.is.windows"> <os family="dos"/> </condition>

	    <pathconvert targetos="${detected.os}" property="this.classpath.translated" refid="this.classpath" />

	  </target>

	<!-- ============================================== -->

	  <target name="prepareMycoreBasics.webapp" depends="prepareMycoreBasics.init">
	    <echo>Preparing mycore web application...</echo>

	    <!-- Create necessary directories  -->
	    <mkdir dir="${this.webapps}"/>

	    <copy todir="${this.webapps}/WEB-INF/lib">
	      <fileset dir="${env.MYCORE_HOME}/lib" includes="*.jar" excludes="servlet-api*" />
	    </copy>
	  	
		<copy todir="${env.MYCOREWCMS_HOME}/webapps/WEB-INF/classes" preservelastmodified="yes">
			<fileset dir="${env.MYCOREWCMS_HOME}/config" >
				<include name="mycore.properties" />
				<include name="mycore.properties.logger" />
				<include name="mycore.properties.private" />
			</fileset>
		</copy>			    	
		<copy todir="${env.MYCOREWCMS_HOME}/webapps/WEB-INF" preservelastmodified="yes">
			<fileset dir="${env.MYCORE_HOME}/modules/module-wcms/appsSupport/standalone/install" >
				<include name="web.xml" />
			</fileset>				
		</copy>			   	  	
	  	
		<copy todir="${env.MYCOREWCMS_HOME}/webpages/css" preservelastmodified="yes">
			<fileset dir="${env.MYCORE_HOME}/modules/module-wcms/appsSupport/standalone/uif/web/css" />
		</copy>			   	  		  	
		<copy todir="${env.MYCOREWCMS_HOME}/webpages/images" preservelastmodified="yes">
			<fileset dir="${env.MYCORE_HOME}/modules/module-wcms/appsSupport/standalone/uif/web/images" />
		</copy>			   	  		  	
	  	
	  </target>

</project>

<!-- ============================================== -->

