<?xml version="1.0" encoding="ISO-8859-1"?>

<!-- Editor form to edit data of a login user -->
<!-- Will be included by new-user.xml and change-user.xml -->

<includes>

  <include id="validation.message">
    <validationMessage>
      <label xml:lang="de">
      Eingabefehler: Bitte korrigieren Sie die markierten Felder.<br/>
      Wenn Sie den Mauszeiger auf das rote Symbol neben dem fehlerhaften<br/>
      Eingabefeld bewegen, sehen Sie weitere Hinweise.
      </label>
      <label xml:lang="en">
      Input error: Please, correct the marked fields.<br />
      To get hints, move the mouse pointer on the red symbol next to the wrong input field.
      </label>
    </validationMessage>
  </include>

  <!-- Read user editor with few fields -->

  <editor id="editor4newReadUser">
    <target type="servlet" name="MCRUserServlet" method="post" format="xml" />
    <include uri="webapp:authorization/user-editor.xml" ref="validation.message" />
    <components root="root" var="/user">
      <panel id="root" lines="on">
        <hidden var="realm/@id" default="local" />
        <include uri="webapp:authorization/user-editor.xml" ref="common" />
        <include uri="webapp:authorization/user-editor.xml" ref="passwords" />
      </panel>
    </components>
  </editor>

  <editor id="editor4changeReadUser">
    <source uri="user:{id}" />
    <cancel url="servlets/MCRUserServlet?action=show&amp;id={id}" />
    <target type="servlet" name="MCRUserServlet" method="post" format="xml" />
    <include uri="webapp:authorization/user-editor.xml" ref="validation.message" />
    <components root="root" var="/user">
      <panel id="root" lines="on">
        <hidden var="realm/@id" default="local" />
        <include uri="webapp:authorization/user-editor.xml" ref="common" />
      </panel>
    </components>
  </editor>

  <!-- User editor for admins with all fields -->

  <editor id="editor4newAdmins">
    <target type="servlet" name="MCRUserServlet" method="post" format="xml" />
    <include uri="webapp:authorization/user-editor.xml" ref="validation.message" />
    <components root="root" var="/user">
      <panel id="root" lines="on">
        <include uri="webapp:authorization/user-editor.xml" ref="common" />
        <include uri="webapp:authorization/user-editor.xml" ref="passwords" />
        <include uri="webapp:authorization/user-editor.xml" ref="editor4admins" />
      </panel>
    </components>
  </editor>

  <editor id="editor4changeAdmins">
    <source uri="user:{id}" />
    <cancel url="servlets/MCRUserServlet?action=show&amp;id={id}" />
    <target type="servlet" name="MCRUserServlet" method="post" format="xml" />
    <include uri="webapp:authorization/user-editor.xml" ref="validation.message" />
    <components root="root" var="/user">
      <panel id="root" lines="on">
        <include uri="webapp:authorization/user-editor.xml" ref="common" />
        <include uri="webapp:authorization/user-editor.xml" ref="editor4admins" />
      </panel>
    </components>
  </editor>

  <include id="editor4admins">

    <cell row="2" col="3" anchor="WEST" style="width: 370px;" var="realm/@id">
      <list type="dropdown">
        <include uri="xslStyle:realms2items:resource:realms.xml" />
      </list>
    </cell>

    <cell row="7" col="1" anchor="EAST">
      <text label="E-Mail" />
      <text label=": " />
    </cell>
    <cell row="7" col="2" colspan="2" anchor="WEST" var="eMail">
      <textfield width="60" maxlength="64" id="tf.email">
        <condition id="cond.email" regexp="\S+@\S+\.\S+">
          <label xml:lang="de">Bitte geben Sie eine syntaktisch korrekte EMail-Adresse ein!</label>
          <label xml:lang="en">Please, enter a syntactically correct email address!</label>
        </condition>
      </textfield>
    </cell>

    <cell row="10" col="1" anchor="EAST">
      <text i18n="component.user2.admin.owner" />
    </cell>
    <cell row="10" col="2" colspan="2" anchor="WEST" var="owner/user">
      <repeater min="1" max="1" lines="off">
        <panel lines="off">
          <hidden descendants="true" />
          <cell row="1" col="1" anchor="WEST">
            <subselect i18n="component.user2.button.select" id="owner.select" type="webpage" href="servlets/MCRUserServlet" style="width: 100px;" />
          </cell>
          <cell row="1" col="2" anchor="WEST">
            <output var="@name" />
            <text label=" [" />
            <output var="realm" default="bitte wählen" />
            <text label="]" />
          </cell>
        </panel>
      </repeater>
    </cell>

    <cell row="11" col="1" anchor="NORTHEAST">
      <text i18n="component.user2.admin.groups" />
    </cell>
    <cell row="11" col="2" colspan="2" anchor="NORTHWEST" var="groups/group">
      <repeater min="0" max="20" lines="off">
        <panel lines="off">
          <hidden descendants="true" />
          <cell row="1" col="1" anchor="WEST">
            <subselect i18n="component.user2.button.select" id="group.select" type="webpage" href="servlets/MCRGroupServlet" style="width: 100px;" />
          </cell>
          <cell row="1" col="2" anchor="WEST">
            <output var="@name" />
            <text label=" [" />
            <output var="label/@text" default="bitte wählen" />
            <text label="]" />
          </cell>
        </panel>
      </repeater>
    </cell>

  </include>

  <!-- Input fields for entering password of new users -->
  <include id="passwords">

    <cell row="3" col="1" anchor="EAST">
      <text i18n="component.user2.admin.password" />
    </cell>
    <cell row="3" col="2" colspan="2" anchor="WEST" var="password">
      <password id="password1" width="10">
        <condition id="cond.password1.syntax" maxLength="16" regexp="[\S]*">
          <label xml:lang="de">Bitte maximal 16 Zeichen, keine Leerzeichen eingeben!</label>
          <label xml:lang="en">Please, enter maximum 16 characters, no blanks!</label>
        </condition>
      </password>
    </cell>
    <cell row="4" col="1" anchor="EAST">
      <text i18n="component.user2.admin.password" />
    </cell>
    <cell row="4" col="2" colspan="2" anchor="WEST" var="password2">
      <password id="password2" width="10">
        <condition id="cond.password2.syntax" maxLength="16" regexp="[\S]*">
          <label xml:lang="de">Bitte maximal 16 Zeichen, keine Leerzeichen eingeben!</label>
          <label xml:lang="en">Please, enter maximum 16 characters, no blanks!</label>
        </condition>
      </password>
      <text i18n="component.user2.admin.passwordIdentically" />
    </cell>

    <!-- Password is only required for local users, then both password fields must be same and are required -->
    <condition id="cond.passwords" xsl="(realm/@id != 'local') or ((string-length(password) &gt; 0) and (password = password2 ))">
      <label xml:lang="de">Für neue lokale Benutzer, füllen Sie bitte beide Passwortfelder identisch aus!</label>
      <label xml:lang="en">For new local users, please fill both password fields identically!</label>
    </condition>

  </include>
  
  <!-- Input fields used in both simple read user editor and user editor for admins -->

  <panel id="common">

    <cell row="2" col="1" anchor="EAST">
      <text i18n="component.user2.admin.userAccount" />
    </cell>
    <cell row="2" col="2" anchor="WEST" var="@name">
      <textfield id="tf.userName" width="16" maxlength="16">
        <condition id="cond.userName" required="true" maxLength="16" regexp="[\S]*">
          <label xml:lang="de">Benutzerkennungen dürfen nur maximal 16 Zeichen lang sein, keine Leerzeichen!</label>
          <label xml:lang="en">For user accounts please enter maximum 16 characters, no blanks!</label>
        </condition>
      </textfield>
    </cell>

    <cell row="5" col="1" anchor="EAST" style="width: 160px;">
      <text i18n="component.user2.admin.passwordHint" />
    </cell>
    <cell row="5" col="2" colspan="2" anchor="WEST" var="hint">
      <textfield width="60" maxlength="128" />
    </cell>

    <cell row="6" col="1" anchor="EAST">
      <text label="Name: " />
    </cell>
    <cell row="6" col="2" colspan="2" anchor="WEST" var="realName">
      <textfield width="60" maxlength="64" />
    </cell>

    <cell row="12" col="1" colspan="3" anchor="SOUTHEAST">
      <cancelButton i18n="component.user2.button.cancel" style="width: 100px;" />
      <text label=" " />
      <submitButton i18n="component.user2.button.save" style="width: 100px;" />
    </cell>

    <condition id="checkUserName" class="org.mycore.user2.MCRUserServlet" method="checkUserName">
      <label xml:lang="de">Diese Nutzerkennung ist im Bereich bereits vergeben!</label>
      <label xml:lang="en">This user account already exists in the area!</label>
    </condition>

  </panel>

</includes>
